# Reference

<!-- DO NOT EDIT: This document was generated by Puppet Strings -->

## Table of Contents

### Classes

* [`role`](#role): Assigns the correct role to each node.  It acts as a proxy which allows you to store your roles in a different namespaced module. For a singl
* [`role::default`](#role--default): Dummy default role that does nothing.

### Functions

* [`role::expand_search_namespaces`](#role--expand_search_namespaces): Sanitizes Role::SearchNamespaces for use in `role`.
* [`role::translate_double_underscores`](#role--translate_double_underscores): Translates all double (or more) underscores in a role to '::'
* [`role::translate_slash`](#role--translate_slash): Translates all (repeated) slashes in a role to '::'
* [`role::translate_with_map`](#role--translate_with_map): Translate a role by executing a gsubstr(pattern, value, 'G') with patterns and values from the provided map.

### Data types

* [`Role::ResolveMethod`](#Role--ResolveMethod): Supported resolve methods
* [`Role::SearchNamespace`](#Role--SearchNamespace): A SearchNamespace can be a single string or a hash.

## Classes

### <a name="role"></a>`role`

Assigns the correct role to each node.

It acts as a proxy which allows you to store your roles in a different namespaced
module. For a single host, you can also use a specific configuration (upstream / shared
roles and profiles).

To get started, you should define the namespace (or search_namespaces) to use.

#### Parameters

The following parameters are available in the `role` class:

* [`namespace`](#-role--namespace)
* [`search_namespaces`](#-role--search_namespaces)
* [`separator`](#-role--separator)
* [`resolve_order`](#-role--resolve_order)
* [`role`](#-role--role)
* [`trusted_extension_name`](#-role--trusted_extension_name)
* [`fact_name`](#-role--fact_name)
* [`function_callback_name`](#-role--function_callback_name)
* [`translate_role_callback`](#-role--translate_role_callback)
* [`default_role`](#-role--default_role)
* [`default_namespace`](#-role--default_namespace)
* [`default_separator`](#-role--default_separator)

##### <a name="-role--namespace"></a>`namespace`

Data type: `Optional[String]`

The module namespace that holds your roles. If you are not using namespaces and map
roles directly to class names, make this an empty string ('').

Default value: `undef`

##### <a name="-role--search_namespaces"></a>`search_namespaces`

Data type: `Optional[Array[Role::SearchNamespace]]`

A list of namespaces to search. If using this, we will attempt to find the
first existing role in order. If no match is found, the puppet run will fail.

Default value: `undef`

##### <a name="-role--separator"></a>`separator`

Data type: `String`

Anything to put in between the namespace and the role.

Default value: `'::'`

##### <a name="-role--resolve_order"></a>`resolve_order`

Data type: `Variant[Role::ResolveMethod, Array[Role::ResolveMethod]]`

The order in which we will be looking for the correct
role to use. Currently supported values are:
* `trusted`: Use a trusted fact. The name must be configured using `trusted_extension_name`.
* `fact`: Use a fact. The name must be configured using `fact_name`.
* `param`: Uses the provided `role` parameter. This can also be used to configure using hiera.
* `callback`: Use a function callback. The function must be configured using `function_callback_name`. (Not available on puppet 4.x!)
* `default`: Fall back to the default value. You would typically put this after other methods.
* `fail`: Fail the run if this method is reached. This enforces setting up a role and skips using the default role.

Default value: `['param', 'default']`

##### <a name="-role--role"></a>`role`

Data type: `Optional[String[1]]`

The role this node should get.

Default value: `undef`

##### <a name="-role--trusted_extension_name"></a>`trusted_extension_name`

Data type: `Optional[String[1]]`

Name of the trusted fact (extension).

Default value: `undef`

##### <a name="-role--fact_name"></a>`fact_name`

Data type: `Optional[String[1]]`

Name of the fact that contains the role.

Default value: `undef`

##### <a name="-role--function_callback_name"></a>`function_callback_name`

Data type: `Optional[String[1]]`

A function that returns the role.

Default value: `undef`

##### <a name="-role--translate_role_callback"></a>`translate_role_callback`

Data type: `Variant[Undef, String[1], Hash]`

Optionally, a function name that should be used or a map with gsubstr tuples.
* function name: A puppet function to call.
    It should accept a single value and return a string. (Not available on puppet 4.x!)
    See `role::translate_slash` and `role::translate_double_underscores` for examples.
* a Hash: A mapping with keypairs that is passed to `role::translate_with_map`.

Default value: `undef`

##### <a name="-role--default_role"></a>`default_role`

Data type: `String`

the default role to assume. Used when no resolve method provides a result.

Default value: `'default'`

##### <a name="-role--default_namespace"></a>`default_namespace`

Data type: `String`

namespace to use if the default is used.

Default value: `'role'`

##### <a name="-role--default_separator"></a>`default_separator`

Data type: `String`

separator to use if the default is used.

Default value: `'::'`

### <a name="role--default"></a>`role::default`

Dummy default role that does nothing.

## Functions

### <a name="role--expand_search_namespaces"></a>`role::expand_search_namespaces`

Type: Puppet Language

This function is used to sanitize user input and return a single map with namespace - separator entries.

#### Examples

##### hiera configured namespaces

```puppet

$search_namespaces = [
  '',
  { 'my_roles' => '_' },
  'public_roles',
]
$expanded = role::expand_search_namespaces('::', $search_namespaces)
# => {'' => '::', 'my_roles' => '_', 'public_roles' => '::' }
```

#### `role::expand_search_namespaces(String $separator, Variant[Role::SearchNamespace, Array[Role::SearchNamespace]] $search)`

This function is used to sanitize user input and return a single map with namespace - separator entries.

Returns: `Hash[String, String]` Expanded configuration.

##### Examples

###### hiera configured namespaces

```puppet

$search_namespaces = [
  '',
  { 'my_roles' => '_' },
  'public_roles',
]
$expanded = role::expand_search_namespaces('::', $search_namespaces)
# => {'' => '::', 'my_roles' => '_', 'public_roles' => '::' }
```

##### `separator`

Data type: `String`

Default separator to use when the namespace does not provide one.

##### `search`

Data type: `Variant[Role::SearchNamespace, Array[Role::SearchNamespace]]`

`Role::SearchNamespace`s to expand.

### <a name="role--translate_double_underscores"></a>`role::translate_double_underscores`

Type: Puppet Language

Translates all double (or more) underscores in a role to '::'

#### `role::translate_double_underscores(String $role)`

Translates all double (or more) underscores in a role to '::'

Returns: `String` Translated role.

##### `role`

Data type: `String`

Role to perform translate on.

### <a name="role--translate_slash"></a>`role::translate_slash`

Type: Puppet Language

Translates all (repeated) slashes in a role to '::'

#### `role::translate_slash(String $role)`

Translates all (repeated) slashes in a role to '::'

Returns: `String` Translated role.

##### `role`

Data type: `String`

Role to perform translate on.

### <a name="role--translate_with_map"></a>`role::translate_with_map`

Type: Puppet Language

Translate a role by executing a gsubstr(pattern, value, 'G') with patterns and
values from the provided map.

#### `role::translate_with_map(String $role, Hash[
    Variant[String, Regexp],
    String
  ] $map, Boolean $strict = false)`

Translate a role by executing a gsubstr(pattern, value, 'G') with patterns and
values from the provided map.

Returns: `String` Translated role.

##### `role`

Data type: `String`

Role to perform translate on.

##### `map`

Data type:

```puppet
Hash[
    Variant[String, Regexp],
    String
  ]
```

A map with gsubstr translations with key as pattern and value
as replacement.

##### `strict`

Data type: `Boolean`

Experimental parameter. If enabled, fails the puppet run when
a role includes characters that are in the target map present as values.
This would indicate that a role is being provided which would not
have expected replacement values in use. (This could happen during a migration,
for example.

## Data types

### <a name="Role--ResolveMethod"></a>`Role::ResolveMethod`

Supported resolve methods

Alias of `Enum['trusted', 'param', 'fact', 'callback', 'default', 'fail']`

### <a name="Role--SearchNamespace"></a>`Role::SearchNamespace`

A SearchNamespace can be a single string or a hash.

Alias of `Variant[String, Hash[String, Optional[String]]]`

